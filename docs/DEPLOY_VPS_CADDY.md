# –î–µ–ø–ª–æ–π TutorBot –Ω–∞ VPS (Ubuntu + Caddy)

–†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ GitHub; –Ω–∞ VPS —É–∂–µ —Ä–∞–±–æ—Ç–∞—é—Ç Caddy –∏ –¥—Ä—É–≥–∏–µ —Å–µ—Ä–≤–∏—Å—ã. –ö–∞–∫ –ø–æ–¥–Ω—è—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –æ—Ç–∫—Ä—ã—Ç—å debug-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∏ –æ–±–Ω–æ–≤–ª—è—Ç—å –µ–≥–æ –ø—Ä–∏ –Ω–æ–≤—ã—Ö –∏—Ç–µ—Ä–∞—Ü–∏—è—Ö.

---

## 1. –ü–µ—Ä–≤–∏—á–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –Ω–∞ VPS (–æ–¥–∏–Ω —Ä–∞–∑)

### 1.1 –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ–∫—Ä—É–∂–µ–Ω–∏–µ

–ù–∞ VPS –æ–±—ã—á–Ω–æ –ø—Ä–æ—â–µ –∫–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –ø–æ **HTTPS** (–Ω–µ –Ω—É–∂–µ–Ω SSH-–∫–ª—é—á –¥–ª—è GitHub):

```bash
# –ù–∞ VPS (root –∏–ª–∏ –≤–∞—à –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)
cd /opt
git clone https://github.com/rgimprovise/GDZ.git tutorbot
cd tutorbot/infra
cp env.example .env
nano .env   # POSTGRES_PASSWORD, BASE_URL (https://–≤–∞—à-–¥–æ–º–µ–Ω-–¥–ª—è-tutorbot), TELEGRAM_*, OPENAI_* –∏ —Ç.–¥.
```

–ï—Å–ª–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π **–ø—Ä–∏–≤–∞—Ç–Ω—ã–π**, –ø–æ—Å–ª–µ `git clone` –ø–æ HTTPS –ø—Ä–∏ –ø–µ—Ä–≤–æ–º `git pull` Git –∑–∞–ø—Ä–æ—Å–∏—Ç –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å ‚Äî —É–∫–∞–∂–∏—Ç–µ –≤–∞—à GitHub **–ª–æ–≥–∏–Ω** –∏ **Personal Access Token** (–Ω–µ –ø–∞—Ä–æ–ª—å –æ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞). –°–æ–∑–¥–∞—Ç—å —Ç–æ–∫–µ–Ω: GitHub ‚Üí Settings ‚Üí Developer settings ‚Üí Personal access tokens.

–ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ SSH (`git@github.com:rgimprovise/GDZ.git`) –≤–æ–∑–º–æ–∂–Ω–æ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–∞ VPS –¥–æ–±–∞–≤–ª–µ–Ω SSH-–∫–ª—é—á –≤ GitHub (Settings ‚Üí SSH and GPG keys –∏–ª–∏ Deploy key —É —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è).

**BASE_URL** —É–∫–∞–∂–∏—Ç–µ —Ç–æ—Ç, –ø–æ –∫–æ—Ç–æ—Ä–æ–º—É –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω API. –î–ª—è —Ç–µ–∫—É—â–µ–≥–æ –¥–µ–ø–ª–æ—è: `https://gdz.n8nrgimprovise.space`.

### 1.2 –î–∞–Ω–Ω—ã–µ (PDF)

–°–æ–∑–¥–∞–π—Ç–µ –∫–∞—Ç–∞–ª–æ–≥ –∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç—É–¥–∞ PDF:

```bash
mkdir -p /opt/tutorbot/data/pdfs
# –ï—Å–ª–∏ PDF —É–∂–µ –µ—Å—Ç—å –Ω–∞ –∫–æ–º–ø–µ ‚Äî —Å –∫–æ–º–ø–∞: rsync -avz ./data/ user@VPS_IP:/opt/tutorbot/data/
```

### 1.3 Caddy: –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ API

API –≤ Docker —Å–ª—É—à–∞–µ—Ç –ø–æ—Ä—Ç **8000** –Ω–∞ —Ö–æ—Å—Ç–µ. –ù—É–∂–Ω–æ –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞—Ç—å –≤–∞—à –¥–æ–º–µ–Ω –Ω–∞ `localhost:8000`.

**–í–∞—Ä–∏–∞–Ω—Ç A:** –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥–∞ Caddy (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

–î–æ–±–∞–≤—å—Ç–µ –±–ª–æ–∫ –≤ –≤–∞—à –æ—Å–Ω–æ–≤–Ω–æ–π Caddyfile (—Ä—è–¥–æ–º —Å –æ—Å—Ç–∞–ª—å–Ω—ã–º–∏ —Å–∞–π—Ç–∞–º–∏):

```bash
sudo nano /etc/caddy/Caddyfile
```

–í—Å—Ç–∞–≤—å—Ç–µ –±–ª–æ–∫ (–ø–æ—Ä—Ç 8000 —Å–≤–æ–±–æ–¥–µ–Ω; –∑–∞–Ω—è—Ç—ã —É –≤–∞—Å: 5678, 8083, 3001, 3002, 3003):

```
# TutorBot GDZ API
gdz.n8nrgimprovise.space {
    encode gzip
    reverse_proxy localhost:8000
}
```

–õ–∏–±–æ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≥–æ—Ç–æ–≤—ã–π —Å–Ω–∏–ø–ø–µ—Ç –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è: `cat /opt/tutorbot/infra/Caddyfile.snippet`.

–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ Caddy:

```bash
sudo systemctl reload caddy
```

**–í–∞—Ä–∏–∞–Ω—Ç B:** –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≥–æ—Ç–æ–≤—ã–π —Å–Ω–∏–ø–ø–µ—Ç –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

```bash
# –ù–∞ VPS –≤ –∫–æ—Ä–Ω–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
cat infra/Caddyfile.snippet
# –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤—ã–≤–æ–¥, –∑–∞–º–µ–Ω–∏—Ç—å tutorbot.example.com –Ω–∞ –≤–∞—à –¥–æ–º–µ–Ω, –¥–æ–±–∞–≤–∏—Ç—å –≤ –≤–∞—à Caddyfile –∏ reload caddy
```

### 1.4 –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

**–ï—Å–ª–∏ Docker Compose –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω**, —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –æ–¥–∏–Ω –∏–∑ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤:

```bash
# –í–∞—Ä–∏–∞–Ω—Ç 1: –ø–ª–∞–≥–∏–Ω Docker Compose v2 (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è, –∫–æ–º–∞–Ω–¥–∞: docker compose)
sudo apt update
sudo apt install -y docker-compose-plugin

# –í–∞—Ä–∏–∞–Ω—Ç 2: —Å—Ç–∞—Ä—ã–π –±–∏–Ω–∞—Ä–Ω–∏–∫ (–∫–æ–º–∞–Ω–¥–∞: docker-compose)
# sudo apt install -y docker-compose
```

–ü—Ä–æ–≤–µ—Ä–∫–∞: `docker compose version` –∏–ª–∏ `docker-compose version`.

**–ï—Å–ª–∏ –ø–æ—Ä—Ç—ã 5432 –∏–ª–∏ 6379 –Ω–∞ VPS —É–∂–µ –∑–∞–Ω—è—Ç—ã** (—Å–∏—Å—Ç–µ–º–Ω—ã–π Postgres/Redis –∏ —Ç.–ø.), –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–∞–π–ª —Å –¥—Ä—É–≥–∏–º–∏ –ø–æ—Ä—Ç–∞–º–∏. **–í–∞–∂–Ω–æ:** —Å–Ω–∞—á–∞–ª–∞ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∏ —É–¥–∞–ª–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã, –∑–∞—Ç–µ–º –ø–æ–¥—Ç—è–Ω–∏—Ç–µ –∫–æ–¥ –∏ –ø–æ–¥–Ω–∏–º–∏—Ç–µ —Å—Ç–µ–∫ –∑–∞–Ω–æ–≤–æ ‚Äî –∏–Ω–∞—á–µ —Å—Ç–∞—Ä—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –æ—Å—Ç–∞—é—Ç—Å—è —Å –ø—Ä–∏–≤—è–∑–∫–æ–π –∫ 5432/6379:

```bash
cd /opt/tutorbot/infra
docker-compose -f docker-compose.yml -f docker-compose.vps-ports.yml down
cd /opt/tutorbot && git pull && cd infra
docker-compose -f docker-compose.yml -f docker-compose.vps-ports.yml up -d --build
docker-compose -f docker-compose.yml -f docker-compose.vps-ports.yml exec api alembic upgrade head
```

–§–∞–π–ª `docker-compose.vps-ports.yml` –ø—Ä–æ–±—Ä–∞—Å—ã–≤–∞–µ—Ç Postgres –Ω–∞ **5433**, Redis –Ω–∞ **6380** (–≤–Ω—É—Ç—Ä–∏ —Å–µ—Ç–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –ø–æ-–ø—Ä–µ–∂–Ω–µ–º—É –∏—Å–ø–æ–ª—å–∑—É—é—Ç 5432 –∏ 6379). –ù–∞ VPS –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–ª—å–∫–æ `-f docker-compose.vps-ports.yml` (—Ñ–∞–π–ª–∞ —Å –ø–æ—Ä—Ç–∞–º–∏ 5432/6379 –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –Ω–µ—Ç).

–õ–æ–∫–∞–ª—å–Ω–æ (–µ—Å–ª–∏ 5432/6379 —Å–≤–æ–±–æ–¥–Ω—ã): `docker-compose -f docker-compose.yml -f docker-compose.local-ports.yml up -d --build`

–ü—Ä–æ–≤–µ—Ä–∫–∞:

```bash
curl -s http://localhost:8000/health
curl -s https://gdz.n8nrgimprovise.space/health   # —á–µ—Ä–µ–∑ Caddy
```

### 1.5 Debug-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Caddy debug-–ø–∞–Ω–µ–ª—å –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ –∞–¥—Ä–µ—Å—É:

- **https://gdz.n8nrgimprovise.space/debug**
- **https://gdz.n8nrgimprovise.space/docs** ‚Äî Swagger
- **https://gdz.n8nrgimprovise.space/health** ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã API

–í debug-–ø–∞–Ω–µ–ª–∏ –¥–æ—Å—Ç—É–ø–Ω—ã:
- **–ó–∞–≥—Ä—É–∑–∏—Ç—å –Ω–æ–≤—ã–π —É—á–µ–±–Ω–∏–∫** ‚Äî –∑–∞–≥—Ä—É–∑–∫–∞ PDF —á–µ—Ä–µ–∑ –≤–µ–±; —Ñ–∞–π–ª —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `data/pdfs/`, —Å–æ–∑–¥–∞—ë—Ç—Å—è –∫–Ω–∏–≥–∞ –∏ –∏—Å—Ç–æ—á–Ω–∏–∫ PDF (–ø–æ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞ ‚Äî –ø—Ä–µ–¥–º–µ—Ç/–∫–ª–∞—Å—Å). –ï—Å–ª–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –æ—à–∏–±–∫–∞ ¬´relation "books" does not exist¬ª ‚Äî —Å–Ω–∞—á–∞–ª–∞ –ø—Ä–∏–º–µ–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏ (–∫–æ–º–∞–Ω–¥–∞ –Ω–∏–∂–µ).
- **–ò—Å—Ç–æ—á–Ω–∏–∫–∏ PDF ‚Äî –Ω–∞—á–∞—Ç—å OCR** ‚Äî –∫–Ω–æ–ø–∫–∞ ¬´–ù–∞—á–∞—Ç—å OCR¬ª —Å—Ç–∞–≤–∏—Ç –≤ –æ—á–µ—Ä–µ–¥—å –ø–∞–π–ø–ª–∞–π–Ω: Tesseract ‚Üí –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è ‚Üí LLM-–∫–æ—Ä—Ä–µ–∫—Ü–∏—è —Ñ–æ—Ä–º—É–ª/OCR (OpenAI) ‚Üí –∑–∞–ø–∏—Å—å –≤ —Ñ–∞–π–ª –∏ –ë–î. –ù–∞ VPS –≤ .env –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–¥–∞–Ω OPENAI_API_KEY. Worker –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω.

**–ü–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –ø–æ–¥—ä—ë–º–∞ –∏–ª–∏ –ø–æ—Å–ª–µ `down -v` –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏:**
```bash
cd /opt/tutorbot/infra
docker-compose -f docker-compose.yml -f docker-compose.vps-ports.yml exec api alembic upgrade head
```

---

## 2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞ –∫–∞–∂–¥–æ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏

–ü–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –Ω–∞ GitHub –ø–æ—è–≤–∏–ª–∏—Å—å –Ω–æ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è.

### 2.1 –£ –≤–∞—Å (–ª–æ–∫–∞–ª—å–Ω–æ): –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ GitHub

```bash
cd /path/to/GDZ
git add -A
git status
git commit -m "–û–ø–∏—Å–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π"
git push origin main
```

(–í–º–µ—Å—Ç–æ `main` –ø–æ–¥—Å—Ç–∞–≤—å—Ç–µ –≤–∞—à—É –≤–µ—Ç–∫—É, –µ—Å–ª–∏ –¥—Ä—É–≥–∞—è.)

### 2.2 –ù–∞ VPS: –æ–¥–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

–ü–æ—Å–ª–µ –ø—É—à–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π –Ω–∞ GitHub –Ω–∞ VPS –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ **–æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥—ã**. –î–∞–Ω–Ω—ã–µ (–ë–î, –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ PDF, OCR-—Ñ–∞–π–ª—ã) **–Ω–µ —É–¥–∞–ª—è—é—Ç—Å—è** ‚Äî —Å–∫—Ä–∏–ø—Ç —Ç–æ–ª—å–∫–æ –ø–æ–¥—Ç—è–≥–∏–≤–∞–µ—Ç –∫–æ–¥, –ø–µ—Ä–µ—Å–æ–±–∏—Ä–∞–µ—Ç –æ–±—Ä–∞–∑—ã, –ø–æ–¥–Ω–∏–º–∞–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∏ –ø—Ä–∏–º–µ–Ω—è–µ—Ç –º–∏–≥—Ä–∞—Ü–∏–∏.

**–û–¥–∏–Ω —Ä–∞–∑** —Å–¥–µ–ª–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º (–µ—Å–ª–∏ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø–æ—è–≤–ª—è–µ—Ç—Å—è ¬´Permission denied¬ª):

```bash
chmod +x /opt/tutorbot/scripts/update_on_vps.sh
```

**–ü—Ä–∏ –∫–∞–∂–¥–æ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏** (–ø–æ—Å–ª–µ `git push` —Å –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã):

```bash
cd /opt/tutorbot && ./scripts/update_on_vps.sh
```

–°–∫—Ä–∏–ø—Ç —Å–∞–º:
- –≤—ã–ø–æ–ª–Ω—è–µ—Ç `git pull origin main`;
- –ø–æ–¥—Å—Ç–∞–≤–ª—è–µ—Ç `docker-compose.vps-ports.yml` (–ø–æ—Ä—Ç—ã 5433/6380), –µ—Å–ª–∏ —Ñ–∞–π–ª –µ—Å—Ç—å;
- –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã (`down` **–±–µ–∑** `-v` ‚Äî –¥–∞–Ω–Ω—ã–µ –∏ volumes –Ω–µ —É–¥–∞–ª—è—é—Ç—Å—è);
- —Å–æ–±–∏—Ä–∞–µ—Ç –æ–±—Ä–∞–∑—ã –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã (`build` —Å –∫—ç—à–µ–º –∏ `up -d`; –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ç–æ–ª—å–∫–æ –∫–æ–¥–∞ –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–∞–∫–µ—Ç–æ–≤ –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è);
- –ø—Ä–∏–º–µ–Ω—è–µ—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î (`alembic upgrade head`).

–¢–∞–∫–æ–π –ø–æ—Ä—è–¥–æ–∫ (—Å–Ω–∞—á–∞–ª–∞ `down`, –∑–∞—Ç–µ–º `up -d`) –∏–∑–±–µ–≥–∞–µ—Ç –æ—à–∏–±–∫–∏ `KeyError: 'ContainerConfig'` —É —Å—Ç–∞—Ä–æ–≥–æ docker-compose –ø—Ä–∏ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤.

–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: `SKIP_PULL=1 ./scripts/update_on_vps.sh` ‚Äî –Ω–µ –¥–µ–ª–∞—Ç—å `git pull` (–Ω–∞–ø—Ä–∏–º–µ—Ä, —É–∂–µ –ø–æ–¥—Ç—è–Ω—É–ª–∏ –≤—Ä—É—á–Ω—É—é). `BRANCH=develop` ‚Äî –¥—Ä—É–≥–∞—è –≤–µ—Ç–∫–∞. –ï—Å–ª–∏ –º–µ–Ω—è–ª–∏ `requirements.txt` –∏–ª–∏ Dockerfile –∏ –Ω—É–∂–Ω–∞ –ø–æ–ª–Ω–∞—è –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –±–µ–∑ –∫—ç—à–∞ ‚Äî –≤—Ä—É—á–Ω—É—é: `cd infra && docker-compose -f docker-compose.yml -f docker-compose.vps-ports.yml build --no-cache`.

–ï—Å–ª–∏ –ø—Ä–∏ pull –ø–æ—è–≤–ª—è–µ—Ç—Å—è ¬´Your local changes would be overwritten¬ª, —Å–∫—Ä–∏–ø—Ç —Å–∞–º —Å–±—Ä–æ—Å–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ **–æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º—ã—Ö** —Ñ–∞–π–ª–∞—Ö (`git checkout -- .`) –∏ –ø–æ–≤—Ç–æ—Ä–∏—Ç pull. –ù–µ–æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º—ã–µ —Ñ–∞–π–ª—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä `.env`) –Ω–µ —Ç—Ä–æ–≥–∞—é—Ç—Å—è. –ï—Å–ª–∏ –Ω–∞ VPS –≤—ã –≤—Ä—É—á–Ω—É—é –ø—Ä–∞–≤–∏–ª–∏ –∫–æ–¥ –∏ —Ö–æ—Ç–∏—Ç–µ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–∞–≤–∫–∏ ‚Äî –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º —Å–∫—Ä–∏–ø—Ç–∞ —Å–¥–µ–ª–∞–π—Ç–µ `git stash`.

---

## 3. –û—à–∏–±–∫–∞ 502 (Bad Gateway)

–ï—Å–ª–∏ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è —Å –∫–æ–¥–æ–º 502, Caddy –Ω–µ –º–æ–∂–µ—Ç –¥–æ—Å—Ç—É—á–∞—Ç—å—Å—è –¥–æ API –Ω–∞ localhost:8000. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ **–Ω–∞ VPS**:

```bash
cd /opt/tutorbot/infra

# 1. –í—Å–µ –ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∑–∞–ø—É—â–µ–Ω—ã? (–¥–æ–ª–∂–Ω—ã –±—ã—Ç—å Up)
docker-compose -f docker-compose.yml -f docker-compose.vps-ports.yml ps -a
```

**–ï—Å–ª–∏ –ø—Ä–∏ `up -d` –ø–∞–¥–∞–µ—Ç —Å `KeyError: 'ContainerConfig'`** (—á–∞—Å—Ç–æ –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è volume –∫ api) ‚Äî –±–∞–≥ —Å—Ç–∞—Ä–æ–≥–æ docker-compose –ø—Ä–∏ ¬´recreate¬ª. –°–Ω–µ—Å—Ç–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∏ –ø–æ–¥–Ω—è—Ç—å –∑–∞–Ω–æ–≤–æ:

```bash
docker-compose -f docker-compose.yml -f docker-compose.vps-ports.yml down
docker-compose -f docker-compose.yml -f docker-compose.vps-ports.yml up -d
docker-compose -f docker-compose.yml -f docker-compose.vps-ports.yml ps -a
```

–ü—Ä–æ–≤–µ—Ä–∫–∞:

```bash
# 2. –õ–æ–≥–∏ API ‚Äî –Ω–µ—Ç –ª–∏ –ø–∞–¥–µ–Ω–∏—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
docker-compose -f docker-compose.yml -f docker-compose.vps-ports.yml logs --tail 100 api

# 3. –°–ª—É—à–∞–µ—Ç –ª–∏ —á—Ç–æ-—Ç–æ –Ω–∞ –ø–æ—Ä—Ç—É 8000
ss -tlnp | grep 8000
curl -s http://127.0.0.1:8000/health
```

–ï—Å–ª–∏ **Postgres –∏–ª–∏ Redis –≤ Exit 128**, —Å–º–æ—Ç—Ä–∏—Ç–µ –∏—Ö –ª–æ–≥–∏:

```bash
docker-compose -f docker-compose.yml -f docker-compose.vps-ports.yml logs postgres
docker-compose -f docker-compose.yml -f docker-compose.vps-ports.yml logs redis
```

–ß–∞—Å—Ç–æ –ø–æ–º–æ–≥–∞–µ—Ç: —Å–Ω–µ—Å—Ç–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∏ –ø–æ–¥–Ω—è—Ç—å –∑–∞–Ω–æ–≤–æ (volumes —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è):

```bash
docker-compose -f docker-compose.yml -f docker-compose.vps-ports.yml down
docker-compose -f docker-compose.yml -f docker-compose.vps-ports.yml up -d
docker-compose -f docker-compose.yml -f docker-compose.vps-ports.yml ps -a
```

–ï—Å–ª–∏ –ª–æ–≥–∏ postgres/redis **–ø—É—Å—Ç—ã–µ** –∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã —Å–Ω–æ–≤–∞ Exit 128 ‚Äî —á–∞—Å—Ç–æ –≤–∏–Ω–æ–≤–∞—Ç—ã **–ø—Ä–∞–≤–∞ –Ω–∞ volume**. –¢–æ–≥–¥–∞ —Å–Ω–µ—Å—Ç–∏ –∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã, –∏ volumes (–ë–î –±—É–¥–µ—Ç –ø—É—Å—Ç–∞—è) –∏ –ø–æ–¥–Ω—è—Ç—å –∑–∞–Ω–æ–≤–æ:

```bash
docker-compose -f docker-compose.yml -f docker-compose.vps-ports.yml down -v
docker-compose -f docker-compose.yml -f docker-compose.vps-ports.yml up -d
# –∑–∞—Ç–µ–º: docker-compose -f docker-compose.yml -f docker-compose.vps-ports.yml exec api alembic upgrade head
```

–ï—Å–ª–∏ –ø–æ—Å–ª–µ —ç—Ç–æ–≥–æ postgres/redis **–≤—Å—ë –µ—â—ë Exit 128**, –∑–∞–ø—É—Å—Ç–∏—Ç–µ –∏—Ö –≤ foreground ‚Äî –≤ –∫–æ–Ω—Å–æ–ª–∏ –ø–æ—è–≤–∏—Ç—Å—è —Ç–µ–∫—Å—Ç –æ—à–∏–±–∫–∏ (–∑–∞—Ç–µ–º Ctrl+C):

```bash
docker-compose -f docker-compose.yml -f docker-compose.vps-ports.yml run --rm postgres
# –∏–ª–∏
docker-compose -f docker-compose.yml -f docker-compose.vps-ports.yml run --rm redis
```

–ï—Å–ª–∏ –ø—Ä–∏ `run --rm` –æ–±–∞ —Å–µ—Ä–≤–∏—Å–∞ —Å—Ç–∞—Ä—Ç—É—é—Ç –±–µ–∑ –æ—à–∏–±–æ–∫ ‚Äî –æ–±—Ä–∞–∑—ã –∏ –∫–æ–Ω—Ñ–∏–≥ –≤ –ø–æ—Ä—è–¥–∫–µ; –æ–¥–Ω–æ–∫—Ä–∞—Ç–Ω—ã–π `run --rm postgres` —É–∂–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç volume. –¢–æ–≥–¥–∞ —Å–Ω–æ–≤–∞ –ø–æ–¥–Ω–∏–º–∏—Ç–µ —Å—Ç–µ–∫ –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å:

```bash
docker-compose -f docker-compose.yml -f docker-compose.vps-ports.yml up -d
docker-compose -f docker-compose.yml -f docker-compose.vps-ports.yml ps -a
```

–ï—Å–ª–∏ –ø—Ä–∏ `up -d` —Å–Ω–æ–≤–∞ Exit 128 ‚Äî –ø—Ä–æ–≤–µ—Ä—å—Ç–µ, –Ω–µ –∑–∞–Ω—è—Ç—ã –ª–∏ –ø–æ—Ä—Ç—ã –Ω–∞ —Ö–æ—Å—Ç–µ: `ss -tlnp | grep -E '5433|6380'`. –ó–∞—Ç–µ–º –∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å—Ç–µ–∫ –≤ foreground (–±–µ–∑ `-d`), —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –≤—ã–≤–æ–¥ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ: `docker-compose -f docker-compose.yml -f docker-compose.vps-ports.yml up`.

**Redis:** –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –ø—Ä–æ `vm.overcommit_memory` –º–æ–∂–Ω–æ —É–±—Ä–∞—Ç—å –Ω–∞ VPS: `sudo sysctl vm.overcommit_memory=1` (–ø–æ—Å—Ç–æ—è–Ω–Ω–æ: –¥–æ–±–∞–≤–∏—Ç—å –≤ `/etc/sysctl.conf` –∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞).

**–ß–∞—Å—Ç—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**
- **Postgres –∏–ª–∏ Redis –≤ Exit 128** ‚Äî —Ç–æ–≥–¥–∞ api/worker –Ω–µ —Å—Ç–∞—Ä—Ç—É—é—Ç. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ postgres –∏ redis (–∫–æ–º–∞–Ω–¥—ã –Ω–∏–∂–µ), –∑–∞—Ç–µ–º –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å—Ç–µ–∫.
- **"address already in use" –¥–ª—è 5432/6379** ‚Äî –ø–æ—Ä—Ç—ã –∑–∞–¥–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ `docker-compose.vps-ports.yml` (5433, 6380). –°–Ω–∞—á–∞–ª–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ `down`, –∑–∞—Ç–µ–º `git pull`, –∑–∞—Ç–µ–º `up -d` ‚Äî –∏–Ω–∞—á–µ —Å—Ç–∞—Ä—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å 5432/6379.

---

## 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ PDF –Ω–∞ VPS

–î–∞–Ω–Ω—ã–µ (–≤ —Ç.—á. PDF) –º–æ–Ω—Ç–∏—Ä—É—é—Ç—Å—è –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞ **`/opt/tutorbot/data`** (–ø—É—Ç—å `../data` –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ `infra/`). PDF –¥–æ–ª–∂–Ω—ã –ª–µ–∂–∞—Ç—å –≤ `data/pdfs/`.

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ PDF –Ω–∞ VPS:**

```bash
# –°–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ –≤ –∫–∞—Ç–∞–ª–æ–≥–µ PDF
ls -la /opt/tutorbot/data/pdfs

# –í—Å–µ PDF –≤ data (–≤–∫–ª—é—á–∞—è –≤–ª–æ–∂–µ–Ω–Ω—ã–µ –ø–∞–ø–∫–∏)
find /opt/tutorbot/data -name "*.pdf"

# –ï—Å—Ç—å –ª–∏ –∫–∞—Ç–∞–ª–æ–≥ data –∏ –ø–æ–¥–∫–∞—Ç–∞–ª–æ–≥ pdfs
ls -la /opt/tutorbot/data
ls -la /opt/tutorbot/data/pdfs 2>/dev/null || echo "–ö–∞—Ç–∞–ª–æ–≥ pdfs –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç"
```

–ï—Å–ª–∏ –∫–∞—Ç–∞–ª–æ–≥–∞ –Ω–µ—Ç: `mkdir -p /opt/tutorbot/data/pdfs`. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å PDF —Å –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã: `rsync -avz ./data/ user@VPS_IP:/opt/tutorbot/data/`.

---

## 5. Debug-–ø–∞–Ω–µ–ª—å ¬´–≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –ø–æ–¥–≥—Ä—É–∑–∫–∏¬ª

–ï—Å–ª–∏ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ **https://gdz.n8nrgimprovise.space/debug** –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è, –Ω–æ –±–ª–æ–∫–∏ ¬´–ö–Ω–∏–≥¬ª, ¬´–ó–∞–¥–∞—á¬ª, ¬´–ö–Ω–∏–≥–∏ –≤ –±–∞–∑–µ¬ª –∏ —Ç.–¥. –æ—Å—Ç–∞—é—Ç—Å—è —Å–∫–µ–ª–µ—Ç–æ–Ω–∞–º–∏ (—Å–µ—Ä—ã–µ –ø–æ–ª–æ—Å–∫–∏), –∑–Ω–∞—á–∏—Ç –∑–∞–ø—Ä–æ—Å—ã HTMX –∫ `/debug/api/*` –Ω–µ –¥–æ—Ö–æ–¥—è—Ç –∏–ª–∏ API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É.

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ VPS:**

```bash
cd /opt/tutorbot/infra

# –û—Ç–≤–µ—Ç API –ø–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ –∏ –∫–Ω–∏–≥–∞–º (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å HTML, –Ω–µ 500)
curl -s -o /dev/null -w "%{http_code}" https://gdz.n8nrgimprovise.space/debug/api/stats
curl -s https://gdz.n8nrgimprovise.space/debug/api/stats | head -5
curl -s https://gdz.n8nrgimprovise.space/debug/api/books | head -5

# –õ–æ–≥–∏ API ‚Äî –æ—à–∏–±–∫–∏ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ –∫ –ë–î (–Ω–µ—Ç —Ç–∞–±–ª–∏—Ü, –Ω–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è)
docker-compose -f docker-compose.yml -f docker-compose.vps-ports.yml logs --tail 50 api
```

**–ß–∞—Å—Ç—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**
- **–ú–∏–≥—Ä–∞—Ü–∏–∏ –Ω–µ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã** ‚Äî —Ç–∞–±–ª–∏—Ü `books`, `problems`, `pdf_pages` –Ω–µ—Ç, API –ø–∞–¥–∞–µ—Ç —Å 500. –í—ã–ø–æ–ª–Ω–∏—Ç–µ:  
  `docker-compose -f docker-compose.yml -f docker-compose.vps-ports.yml exec api alembic upgrade head`
- **–ë–î –ø—É—Å—Ç–∞—è** ‚Äî –ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–π –ø–∞–Ω–µ–ª—å –ø–æ–∫–∞–∂–µ—Ç –Ω—É–ª–∏ –∏ ¬´–ö–Ω–∏–≥–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã¬ª; —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ, –ø–æ–∫–∞ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã –∫–Ω–∏–≥–∏ –∏ PDF (seed_books, –∑–∞–≥—Ä—É–∑–∫–∞ PDF –≤ `data/pdfs/`, ingestion).

---

## 6. –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –Ω–∞ VPS

```bash
cd /opt/tutorbot/infra
COMPOSE="docker-compose -f docker-compose.yml -f docker-compose.vps-ports.yml"
```

**–í–∞–∂–Ω–æ:** –≤—Å–µ –∫–æ–º–∞–Ω–¥—ã —Å `docker-compose` (–ª–æ–≥–∏, ps, exec –∏ —Ç.–¥.) –Ω—É–∂–Ω–æ –≤—ã–ø–æ–ª–Ω—è—Ç—å –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞ **infra** ‚Äî –∏–Ω–∞—á–µ –±—É–¥–µ—Ç –æ—à–∏–±–∫–∞ `No such file or directory: './docker-compose.yml'`.

**–õ–æ–≥–∏ OCR (worker)** ‚Äî –ø–∞–π–ø–ª–∞–π–Ω Tesseract ‚Üí –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è ‚Üí –ë–î –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ `worker`:

```bash
# –ü–æ—Å–ª–µ–¥–Ω–∏–µ 200 —Å—Ç—Ä–æ–∫ (–ø–æ –Ω–∏–º –≤–∏–¥–Ω–æ –ø—Ä–æ–≥—Ä–µ—Å—Å –∏ –æ—à–∏–±–∫–∏)
$COMPOSE logs --tail 200 worker

# –°–ª–µ–¥–∏—Ç—å –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ (—É–¥–æ–±–Ω–æ –ø–æ—Å–ª–µ –Ω–∞–∂–∞—Ç–∏—è ¬´–ù–∞—á–∞—Ç—å OCR¬ª)
$COMPOSE logs -f worker
```

**–õ–æ–≥–∏ API, —Å—Ç–∞—Ç—É—Å, –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫:**

```bash
$COMPOSE logs -f api
$COMPOSE ps
$COMPOSE down && $COMPOSE up -d
```

---

## 7. –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç

–ß–µ–∫-–ª–∏—Å—Ç (–≤—ã–ø–æ–ª–Ω—è—Ç—å –∏–∑ `cd /opt/tutorbot/infra`, `$COMPOSE` = `docker-compose -f docker-compose.yml -f docker-compose.vps-ports.yml`):

| –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å | –ö–æ–º–∞–Ω–¥–∞ –∏–ª–∏ –¥–µ–π—Å—Ç–≤–∏–µ |
|---------------|----------------------|
| **–°–µ—Ä–≤–∏—Å—ã –æ—Ç–≤–µ—á–∞—é—Ç** | `curl -s http://127.0.0.1:8000/health` ‚Üí `{"status":"ok"}` –∏–ª–∏ –∞–Ω–∞–ª–æ–≥ |
| **–°–∞–π—Ç —á–µ—Ä–µ–∑ Caddy** | –í –±—Ä–∞—É–∑–µ—Ä–µ: https://gdz.n8nrgimprovise.space/health –∏ https://gdz.n8nrgimprovise.space/debug |
| **–í—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã Up** | `$COMPOSE ps -a` ‚Äî api, worker, postgres, redis, minio –±–µ–∑ Exit |
| **–õ–æ–≥–∏ worker (–ø–æ—Å–ª–µ–¥–Ω–∏–µ N —Å—Ç—Ä–æ–∫)** | `$COMPOSE logs --tail 300 worker` ‚Äî –ø–æ—Å–ª–µ —Å—Ç–∞—Ä—Ç–∞ –∑–∞–¥–∞—á–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å—Ç—Ä–æ–∫–∏ –≤–∏–¥–∞ `üìÑ Processing PDF source`, `üì∑ OCR: Tesseract`, `üìÉ OCR: 1/... pages`, –≤ –∫–æ–Ω—Ü–µ `‚úÖ Done` –∏–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ |
| **–°–æ—Å—Ç–æ—è–Ω–∏–µ OCR –≤ –ë–î** | –í debug-–ø–∞–Ω–µ–ª–∏ –±–ª–æ–∫ ¬´–ò—Å—Ç–æ—á–Ω–∏–∫–∏ PDF¬ª: —Å—Ç–∞—Ç—É—Å –∏—Å—Ç–æ—á–Ω–∏–∫–∞ —Å—Ç–∞–Ω–µ—Ç **done** –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ OCR –∏–ª–∏ **failed** –ø—Ä–∏ –æ—à–∏–±–∫–µ; –±–ª–æ–∫ ¬´–ö–Ω–∏–≥–∏ –≤ –±–∞–∑–µ¬ª ‚Äî –∫–æ–ª–æ–Ω–∫–∞ ¬´–ó–∞–¥–∞—á¬ª —Å—Ç–∞–Ω–µ—Ç > 0 –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø–∞–π–ø–ª–∞–π–Ω–∞ |
| **–û—á–µ—Ä–µ–¥—å Redis** | –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏: `docker exec -it tutorbot_redis redis-cli LLEN rq:queue:ingestion` ‚Äî –¥–ª–∏–Ω–∞ –æ—á–µ—Ä–µ–¥–∏; `KEYS rq:job:*` ‚Äî –∑–∞–¥–∞—á–∏ |

–ï—Å–ª–∏ –ø–æ—Å–ª–µ —Å—Ç—Ä–æ–∫–∏ `ingestion: ingestion.process_pdf_source(1)` –≤ –ª–æ–≥–∞—Ö –Ω–µ—Ç –≤—ã–≤–æ–¥–∞ (–Ω–µ—Ç ¬´Processing PDF source¬ª, ¬´OCR: Tesseract¬ª) ‚Äî –≤–∫–ª—é—á—ë–Ω –Ω–µ–±—É—Ñ–µ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –≤—ã–≤–æ–¥: –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ worker –∑–∞–¥–∞–Ω–æ `PYTHONUNBUFFERED=1`. –ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ worker –ª–æ–≥–∏ –¥–æ–ª–∂–Ω—ã –ø–æ—è–≤–ª—è—Ç—å—Å—è –ø–æ –º–µ—Ä–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è. –ï—Å–ª–∏ –∑–∞–¥–∞—á–∞ –ø–∞–¥–∞–µ—Ç —Å—Ä–∞–∑—É ‚Äî –ø—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ PDF –¥–æ—Å—Ç—É–ø–µ–Ω –≤–æ—Ä–∫–µ—Ä—É: `docker exec tutorbot_worker ls -la /app/data/pdfs/`.

**–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–π–ª–æ–≤ –ø–æ—Å–ª–µ OCR (—Å—ã—Ä–æ–π –∏ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç):**  
–ù–∞ —Ö–æ—Å—Ç–µ –∫–∞—Ç–∞–ª–æ–≥ `data` —Å–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω –≤ `/opt/tutorbot/data`. –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ OCR –¥–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è:
- —Å—ã—Ä–æ–π OCR: `data/ocr_raw/{book_id}/{pdf_source_id}_tesseract.md`
- –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π (–¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ —à–∞–≥–∞/–∏–º–ø–æ—Ä—Ç–∞): `data/ocr_normalized/{book_id}/{pdf_source_id}.md`

```bash
# –°–ø–∏—Å–æ–∫ –∏ —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–æ–≤ (book_id=1, pdf_source_id=1)
ls -la /opt/tutorbot/data/ocr_raw/1/
ls -la /opt/tutorbot/data/ocr_normalized/1/

# –†–∞–∑–º–µ—Ä –∏ —á–∏—Å–ª–æ —Å—Ç—Ä–æ–∫ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
wc -l /opt/tutorbot/data/ocr_normalized/1/1.md
head -80 /opt/tutorbot/data/ocr_normalized/1/1.md
```

–ò–ª–∏ –∏–∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞: `docker exec tutorbot_worker ls -la /app/data/ocr_normalized/1/` –∏ `docker exec tutorbot_worker head -80 /app/data/ocr_normalized/1/1.md`.

---

## 8. –ò—Ç–æ–≥

| –î–µ–π—Å—Ç–≤–∏–µ              | –ì–¥–µ      | –ö–æ–º–∞–Ω–¥–∞ |
|-----------------------|----------|---------|
| –ü—É—à –∏–∑–º–µ–Ω–µ–Ω–∏–π         | –õ–æ–∫–∞–ª—å–Ω–æ | `git add -A && git commit -m "..." && git push origin main` |
| –û–±–Ω–æ–≤–∏—Ç—å –Ω–∞ VPS       | VPS      | `cd /opt/tutorbot && ./scripts/update_on_vps.sh` |
| –û—Ç–∫—Ä—ã—Ç—å debug-–ø–∞–Ω–µ–ª—å | –ë—Ä–∞—É–∑–µ—Ä  | **https://gdz.n8nrgimprovise.space/debug** |
| –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç | –†–∞–∑–¥–µ–ª –≤—ã—à–µ | ¬ß7 –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç |
