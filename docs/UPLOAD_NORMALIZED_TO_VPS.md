# Подгрузка готового нормализованного файла на VPS

Инструкция для случая, когда нормализованный файл (например `1.md`) подготовлен **локально** (извлечение из кликабельного PDF, локальная нормализация) и его нужно использовать на VPS для «LLM нормализация» и «Распределение в БД» без перезапуска OCR.

## Шаги

1. **Путь на VPS:** воркер читает данные из `DATA_DIR`; в Docker смонтирован каталог `../data` относительно `infra/` в `/app/data`. На хосте это **`/opt/tutorbot/data`** (если репозиторий в `/opt/tutorbot`). Файл для книги 1 и источника 1:
   ```text
   /opt/tutorbot/data/ocr_normalized/1/1.md
   ```
   Для других — `data/ocr_normalized/{book_id}/{pdf_source_id}.md`.

2. **Загрузка файла на VPS** (с вашего компьютера):
   ```bash
   ssh user@your-vps "mkdir -p /opt/tutorbot/data/ocr_normalized/1"
   scp data/ocr_normalized/1/1.md user@your-vps:/opt/tutorbot/data/ocr_normalized/1/
   ```
   Либо через `rsync`:
   ```bash
   rsync -avz data/ocr_normalized/1/1.md user@your-vps:/opt/tutorbot/data/ocr_normalized/1/
   ```

3. **Проверка на VPS:**
   ```bash
   ssh user@your-vps "head -20 /opt/tutorbot/data/ocr_normalized/1/1.md"
   ```

4. **В debug-панели:** для нужного источника (например pdf_source_id=1) нажмите **«LLM нормализация»** (опционально), затем **«Распределение в БД»**. Перезапуск OCR («Начать OCR») не нужен.

---

## Когда на VPS не должен попадать тестовый код

Если у вас есть **тестовые изменения в коде** (например скрипт извлечения текста из PDF с «ocr» в имени — он вынесен в `scripts/local_only/run_embedded_pdf_extract.py`), которые пока не должны влиять на приложение на VPS:

- Держите эти изменения в **отдельной ветке** и не мержите их в ту ветку, с которой деплоите VPS (`update_on_vps.sh` делает `git pull` и пересборку). Либо не пушьте тестовые коммиты в репозиторий до готовности.
- Подгрузка только файла `1.md` (как выше) и кнопки «LLM нормализация» / «Распределение в БД» работают с **уже развёрнутой** версией приложения на VPS без обновления кода — то есть можно пушить и запускать `./scripts/update_on_vps.sh` для остальных доработок, а тестовый код оставить локально или в отдельной ветке.
